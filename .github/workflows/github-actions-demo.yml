name: learn-github-actions-with-django
run-name: ${{ github.actor }} is learning GitHub Actions
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      PG_NAME: ${{ secrets.PG_NAME }}
      PG_USER: ${{ secrets.PG_USER }}
      PG_PASSWORD: ${{ secrets.PG_PASSWORD }}
      PG_HOST: ${{ secrets.PG_HOST }}
      PG_PORT: ${{ secrets.PG_PORT }}
      DJANGO_SECRET_KEY: ${{secrets.DJANGO_SECRET_KEY}}

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Debug - Listar ENV
        run: env

      - name: Upgrade PIP
        run: pip install --upgrade pip

      - name: Install Project Dependencies
        run: pip install -r requirements.txt

      - name: Install Development Dependencies
        run: pip install -r requirements_dev.txt

      - name: Create Container network
        run: docker network create flix_network

      - name: Start DB Service
        run: docker run --name ${PG_NAME} \
          -e POSTGRES_DB=${PG_NAME} \
          -e POSTGRES_PASSWORD=${PG_PASSWORD} \
          -p ${PG_PORT}:${PG_PORT} \
          -v "/home/willames/TI/Cursos/Django Master/flix-api/.pg_flix:/var/lib/postgresql/data" \
          --network=flix_network \
          -d postgres

      - name: Start Web Service
        run: docker run  --name flix_web \
            --network=flix_network \
            -p 8000:8000 \
            flix_web:0.1

